create or replace PROCEDURE SP_SL_PEDIDO(IDUSER IN USUARIOS.ID_USUARIO%TYPE)
AS
pedido_cursor SYS_REFCURSOR;
respuesta EXCEPTION;
BEGIN
SAVEPOINT prev;
OPEN pedido_cursor FOR

SELECT P.CODIGO_PEDIDO AS CODIGO,TD.NOMBRE_DOCUMENTO AS DOCUMENTO,
P.FECHA_ENVIO AS ENVIO,
E.ESTADO AS ESTADO,P.ID_PEDIDO AS ID,
P.FECHA_PEDIDO AS PEDIDO,
TP.TIPO_PAGO AS PAGO,
P.MONTO_TOTAL AS TOTAL
FROM PEDIDO P INNER JOIN ESTADO E ON E.ID_ESTADO=P.ID_ESTADO_PEDIDO  
INNER JOIN TIPO_PAGO TP ON TP.ID_TIPO_PAGO=P.ID_TIPOPAGO_PEDIDO
INNER JOIN TIPO_DOCUMENTO TD ON TD.ID_DOCUMENTO=P.ID_DOCUMENTO_PEDIDO
WHERE P.ID_USUARIO_PEDIDO=1;

APEX_JSON.write( pedido_cursor);
COMMIT;
EXCEPTION
WHEN respuesta then
    HTP.print(SQLERRM);
    WHEN OTHERS THEN
    HTP.print(SQLERRM);
END SP_SL_PEDIDO;